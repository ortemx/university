<!doctype html>
<html>
<head>
<title>Вращение</title>
<meta http-equiv="Content-Type" 
      content="text/html;">
</head>
<body><center>
<style type="text/css">
	body { background-color: #fff; }
     font { color: #8006bf; font-size: 14pt; font-family: arial; }
	.MyTable { width: 450px; margin-left: 50px; 
                text-align: center; }
	.MyTable td { padding:2px; 
                   border:#F0F8FF 1px solid;}
	.MyTable tr { background: #F0FFF0; height: 20px; }
	canvas { margin-left: 50px; }
    </style>
    <script type="text/javascript">
		function II(x)
		{ return Math.round(I1 + (I2-I1)*(x-x1)/(x2-x1)); }

		function JJ(y)
		{ return Math.round(J1 + (J2-J1)*(y-y1)/(y2-y1)); }

		function draweaxis (){
            ctx.beginPath();
            ctx.lineWidth = 2;  
            ctx.strokeStyle = "gray";			
			for ( var i = Math.floor(x1); i <= Math.ceil(x2); i++){ 
                ctx.moveTo(II(i), JJ(y1));
                ctx.lineTo(II(i), JJ(y2));
            }
            for ( var i =  Math.floor(y2); i <= Math.ceil(y1); i++){
                ctx.moveTo(II(x1), JJ(i));
                ctx.lineTo(II(x2), JJ(i));
            }
            ctx.closePath();
            ctx.stroke();
            ctx.beginPath();
            ctx.lineWidth = 3;  
            ctx.strokeStyle = "navy";
            ctx.moveTo(II(x1), JJ(0));
            ctx.lineTo(II(x2), JJ(0));
            ctx.moveTo(II(0), JJ(y1));
            ctx.lineTo(II(0), JJ(y2));
            ctx.closePath();
            ctx.stroke();   
		}

		function drawpoint (x, y){
			ctx.beginPath();
			ctx.fillStyle = '#f02b3f';
			x = II(x,x1,x2);
			y = JJ(y,y1,y2);
			ctx.arc(x, y, 5, 0, 2 * Math.PI, true);
			ctx.closePath();
			ctx.fill();
		}

		function newpoint(x1, y1, x2, y2, angle){
			var sin = +Math.sin(Math.PI*angle/180).toFixed(4);
			var cos = +Math.cos(Math.PI*angle/180).toFixed(4);
			var rotate = [
				[cos, sin, 0 ],
			 	[-sin, cos, 0],
			 	[-x1*(cos-1)+y1*sin, -y1*(cos -1) - x1 * sin,  1]
			];
			var vector = [x2, y2, 1];
			var vector_rez = [0, 0, 0];

			for (var i=0; i<3; i++)
       			for (var j=0; j<3; j++)
           			vector_rez[i] += vector[j] * rotate[j][i];
           	zx = vector_rez[0];
           	zy = vector_rez[1];
            console.log(x2, y2, x1, y1, zx, zy)
		}

		function drawpath(){
			var pivot1 = 0;
			var pivot2 = 0;
			if (angle > 0 )
				pivot2 = angle;
			else
				pivot1 = angle;
			
			for (var i = pivot1; i < pivot2; i+=3) {
				newpoint(xx1, yy1, xx2, yy2, i)               	
        ctx.beginPath();               	
        ctx.lineWidth = 1;  
        ctx.strokeStyle = "#6fd689";
        ctx.moveTo(II(xx1), JJ(yy1));
        ctx.lineTo(II(zx), JJ(zy));
        ctx.closePath();
        ctx.stroke();
        drawpoint (zx, zy);
			}

		}

		function Koord(form){
			var elems = form.elements;
			if ((!elems.x1.value) ||
       (!elems.y1.value) || 
       (!elems.x2.value) || 
       (!elems.y2.value) ||
       (!elems.angle.value)) {
				alert('Неверные значения параметров!');
			}
      else {
		  	var canvas = document.getElementById("canv");
				ctx    = canvas.getContext('2d');
				I1 = 2; 
				J1 = 2; 		        
		    I2 = canvas.width-2; 
				J2 = canvas.height-2;

				ctx.beginPath();
        ctx.fillStyle = '#fff';
        ctx.clearRect(0,0,canvas.width, canvas.height);
        ctx.fillRect(0,0,canvas.width, canvas.height);
        ctx.closePath();
        ctx.stroke();

				xx1 = parseFloat(elems.x1.value); 
        yy1 = parseFloat(elems.y1.value);
   			xx2 = parseFloat(elems.x2.value); 
        yy2 = parseFloat(elems.y2.value);
      	if (xx1 == xx2 && yy1 == yy2) {
        		alert('Неверные значения x1 и x2...');
          	return 0;
       	}

        var r = Math.sqrt((xx1-xx2) ** 2 + (yy1-yy2) ** 2);
        x1 = xx1 - (r + 3);
       	x2 = xx1 + (r + 3);
        y1 = yy1 + (r + 3);
        y2 = yy1 - (r + 3);
        zx = 0, zy = 0;
        angle =  parseFloat(elems.angle.value);
       	draweaxis ();

       	drawpoint (xx1, yy1);
       	drawpoint (xx2, yy2);
       	
       	drawpath ();
        return 0;
       }
    }
	</script>

<form>
    <table cellpadding="2" class="MyTable" border="1">
    <tr><td bgcolor="#ffff60" colspan="4">
    <font >
        Вращение точки B(x2,y2) вокруг точки A(x1,y1)
    </font></td></tr>	
    <tr><td colspan="4"><h4>Задайте координаты  точки A (x1,y1) 
      и точки B (x2,y2) (в декартовой системе координат)
    </h4></td></tr>
	 <tr>
	    <td> 
            x1 = <input style="font-size: 16px; 
                  width: 60px; height: 20px;" name="x1" 
                  type="number" value = 464 >                         
            </td>
	    <td>
            y1 = <input style="font-size: 16px; 
                  width: 60px; height: 20px;" name="y1" 
                  type="number" value = 243 >                         
            </td>
            <td>
            x2 = <input style="font-size: 16px; 
                  width: 60px; height: 20px;" name="x2" 
                  type="number"  value = 278 >                         
            </td>
	    <td>
            y2 = <input style="font-size: 16px; 
                  width: 60px; height: 20px;" name="y2" 
                  type="number" value = 243 >                         
            </td>
	 </tr>
  	 <tr>
	  <td  bgcolor=#33ff60 colspan="4">
          <input style="font-size: 16px; width: 60px; height: 20px;" 
          name="angle" type="number" value="-90" onchange="Koord(this.form)"> 
          <input type="button" name="button1" onclick="Koord(this.form)" value = "нарисовать">                        
          </td>
	 </tr>
	</table>
</form>
<p>
  <canvas id="canv" width="800" height="800"></canvas>
</p>
</body>
</html>
